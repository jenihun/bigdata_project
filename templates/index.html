<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet 지도와 레이더 차트</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh;
            width: 100vw;
        }

        #radarChartContainer {
            display: none;
            position: absolute;
            background-color: white;
            z-index: 1000;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #chartContainer {
            width: 300px; /* 레이더 차트를 표시할 팝업의 너비 조절 */
            height: 300px; /* 레이더 차트를 표시할 팝업의 높이 조절 */
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- 레이더 차트를 그리는 JavaScript 코드 -->
    <div id="radarChartContainer">
        <div id="chartContainer">
            <canvas id="radarChart"></canvas>
        </div>
    </div>

    <script>
        var map = L.map('map').setView([37.5665, 126.9780], 4);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        var myRadarChart; // 레이더 차트 객체
        var container = document.getElementById('radarChartContainer');
        var marker = L.marker([37.5665, 126.9780]).addTo(map);

        // Event handler for zoomend event
        map.on('zoomend', function() {
            // Get the current zoom level
            var currentZoom = map.getZoom();

            console.log('Current Zoom Level: ', currentZoom);

            // Check if the zoom level is below a certain threshold
            if (currentZoom < 3) {
                // Set the zoom level to your desired value
                map.setZoom(3);
            }
        });

        function showRadarChart(event) {
            // 예시 데이터
            var radarData = {
                labels: ['A', 'B', 'C', 'D', 'E'],
                datasets: [{
                    label: 'Data',
                    data: [5, 3, 7, 2, 8],
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2
                }]
            };

            // 레이더 차트를 그리기
            var ctx = document.getElementById('radarChart').getContext('2d');

            // 이미 레이더 차트가 생성되어 있다면 객체를 제거하고 다시 생성
            if (myRadarChart) {
                myRadarChart.destroy();
            }

            myRadarChart = new Chart(ctx, {
                type: 'radar',
                data: radarData,
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });

            // 팝업 위치 설정
            container.style.left = event.containerPoint.x + 'px';
            container.style.top = event.containerPoint.y + 'px';

            // 팝업 열기
            container.style.display = 'block';

            // 문서 전체에 클릭 이벤트 리스너 추가
            document.addEventListener('click', closePopupOutside);
        }

        // 클릭 이벤트 리스너
        function closePopupOutside(event) {
            // 클릭한 요소가 팝업과 관련된 요소인지 확인
            if (!container.contains(event.target) && !marker._icon.contains(event.target)) {
                // 팝업 외부를 클릭한 경우 팝업 닫기
                container.style.display = 'none';

                // 클릭 이벤트 리스너 제거
                document.removeEventListener('click', closePopupOutside);
            }
        }

        // 초기화면에서 팝업이 보이지 않도록 설정
        container.style.display = 'none';

        // 마커 클릭 시 레이더 차트 표시
        marker.on('click', showRadarChart);
    </script>
</body>
</html>